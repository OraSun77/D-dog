<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <title>birthday scratch card mobile</title>
    <style>
        #scratchContainer {
            position: relative;
            margin: 20px auto;
            width: 300px;
            height: 150px;
        }

        #scratchImage {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        #prize {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: red;
            font-size: 24px;
            font-weight: bold;
            display: none; /* 初始隐藏中奖提示 */
        }

        #coverLayer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #f1f1f1;
        }
    </style>
    <script>
        window.addEventListener('DOMContentLoaded', function () {
            var scratchContainer = document.getElementById('scratchContainer');
            var coverLayer = document.getElementById('coverLayer');
            var ctx = coverLayer.getContext('2d');
            var image = new Image();
            var isScratching = false;

            var prizeText = document.getElementById('prize');

            image.src = 'path_to_your_image.jpg'; // 替换为实际的刮奖图片路径

            image.onload = function () {
                ctx.drawImage(image, 0, 0, coverLayer.width, coverLayer.height);
            };

            function scratch(e) {
                e.preventDefault();
                if (!isScratching) return;
                ctx.globalCompositeOperation = 'destination-out';

                var touches = e.changedTouches;
                for (var i = 0; i < touches.length; i++) {
                    var rect = coverLayer.getBoundingClientRect();
                    var touchX = touches[i].clientX - rect.left;
                    var touchY = touches[i].clientY - rect.top;
                    ctx.beginPath();
                    ctx.arc(touchX, touchY, 20, 0, Math.PI * 2, false);
                    ctx.fill();
                }

                // 刮开涂层后显示中奖提示
                if (ctx.getImageData(0, 0, coverLayer.width, coverLayer.height).data.every(isTransparent)) {
                    prizeText.style.display = 'block';
                }
            }

            function isTransparent(value) {
                return value === 0; // 刮开涂层后像素点透明度为0
            }

            function startScratching() {
                isScratching = true;
            }

            function stopScratching() {
                isScratching = false;
            }

            coverLayer.addEventListener('touchstart', startScratching);
            coverLayer.addEventListener('touchend', stopScratching);
            coverLayer.addEventListener('touchmove', scratch);
        });
    </script>
</head>
<body>
    <div id="scratchContainer">
        <canvas id="coverLayer" width="300" height="150"></canvas>
        <img id="scratchImage" src="../static/picture/kuromi.jpeg" alt="">
        <div id="prize">中奖啦！</div>
    </div>
</body>
</html>