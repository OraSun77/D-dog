<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <title>birthday scratch card mobile</title>
    <style>
        #scratchArea {
            position: relative;
            margin: 20px auto;
            width: 300px;
            height: 150px;
            border: 2px solid #ccc;
            background: #f1f1f1;
            overflow: hidden;
            border-radius: 5px;
        }

        #scratchImage {
            display: block;
            width: 100%;
            height: 100%;
        }

        #prize {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: red;
            font-size: 24px;
            font-weight: bold;
            display: none; /* 初始隐藏中奖提示 */
        }
    </style>
    <script>
        window.addEventListener('DOMContentLoaded', function () {
            var scratchArea = document.getElementById('scratchArea');
            var ctx = scratchArea.getContext('2d');
            var image = new Image();
            var isScratching = false;

            var prizeText = document.getElementById('prize');

            image.src = '../static/picture/kuromi.jpeg'; // 替换为实际的刮奖图片路径

            image.onload = function () {
                ctx.drawImage(image, 0, 0, scratchArea.width, scratchArea.height);
            };

            function scratch(e) {
                e.preventDefault();
                if (!isScratching) return;
                ctx.globalCompositeOperation = 'destination-out';

                var touches = e.changedTouches;
                for (var i = 0; i < touches.length; i++) {
                    var rect = scratchArea.getBoundingClientRect();
                    var touchX = touches[i].clientX - rect.left;
                    var touchY = touches[i].clientY - rect.top;
                    ctx.beginPath();
                    ctx.arc(touchX, touchY, 20, 0, Math.PI * 2, false);
                    ctx.fill();
                }

                // 刮开涂层后显示中奖提示
                if (ctx.getImageData(0, 0, scratchArea.width, scratchArea.height).data.every(isTransparent)) {
                    prizeText.style.display = 'block';
                }
            }

            function isTransparent(value) {
                return value === 0; // 刮开涂层后像素点透明度为0
            }

            function startScratching() {
                isScratching = true;
            }

            function stopScratching() {
                isScratching = false;
            }

            scratchArea.addEventListener('touchstart', startScratching);
            scratchArea.addEventListener('touchend', stopScratching);
            scratchArea.addEventListener('touchmove', scratch);
        });
    </script>
</head>
<body>
    <canvas id="scratchArea" width="300" height="150"></canvas>
    <div id="prize">中奖啦！</div>
</body>
</html>